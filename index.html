<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lead Tracker CRM - JSON Storage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icon Components
        const Phone = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
            </svg>
        );

        const Plus = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Edit2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Search = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Flame = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path>
            </svg>
        );

        const Thermometer = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"></path>
            </svg>
        );

        // Main App
        function LeadTrackerApp() {
            const [leads, setLeads] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [editingLead, setEditingLead] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterStatus, setFilterStatus] = useState('all');
            const [filterTemperature, setFilterTemperature] = useState('all');

            const [formData, setFormData] = useState({
                name: '',
                phone: '',
                countryCode: '+251',
                conversation: '',
                status: 'New',
                temperature: 'Warm'
            });

            // Load from localStorage on mount
            useEffect(() => {
                const stored = localStorage.getItem('leads');
                if (stored) {
                    try {
                        setLeads(JSON.parse(stored));
                    } catch (e) {
                        console.error('Error loading leads:', e);
                    }
                }
            }, []);

            // Save to localStorage whenever leads change
            useEffect(() => {
                localStorage.setItem('leads', JSON.stringify(leads));
            }, [leads]);

            const statusOptions = ['New', 'Contacted', 'Follow-Up', 'Meeting Scheduled', 'Closed Won', 'Closed Lost'];
            const temperatureOptions = ['Cold', 'Warm', 'Hot'];

            // Export to JSON file
            const exportToJSON = () => {
                const dataStr = JSON.stringify(leads, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `leads_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            // Import from JSON file
            const importFromJSON = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedLeads = JSON.parse(e.target.result);
                            if (Array.isArray(importedLeads)) {
                                if (window.confirm(`Import ${importedLeads.length} leads? This will replace your current data.`)) {
                                    setLeads(importedLeads);
                                }
                            } else {
                                alert('Invalid JSON format. Expected an array of leads.');
                            }
                        } catch (error) {
                            alert('Error parsing JSON file: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
                event.target.value = '';
            };

            const handleSubmit = () => {
                if (!formData.name || !formData.phone || !formData.conversation) {
                    alert('Please fill in all required fields');
                    return;
                }

                const fullPhone = `${formData.countryCode} ${formData.phone}`;

                if (editingLead) {
                    setLeads(leads.map(lead =>
                        lead.id === editingLead.id
                            ? { ...formData, phone: fullPhone, id: lead.id, createdAt: lead.createdAt, updatedAt: new Date().toISOString() }
                            : lead
                    ));
                    setEditingLead(null);
                } else {
                    const newLead = {
                        ...formData,
                        phone: fullPhone,
                        id: Date.now().toString(),
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    setLeads([newLead, ...leads]);
                }

                setFormData({
                    name: '',
                    phone: '',
                    countryCode: '+251',
                    conversation: '',
                    status: 'New',
                    temperature: 'Warm'
                });
                setShowForm(false);
            };

            const handleEdit = (lead) => {
                setEditingLead(lead);
                const phoneMatch = lead.phone.match(/^(\+\d+)\s(.+)$/);
                setFormData({
                    name: lead.name,
                    phone: phoneMatch ? phoneMatch[2] : lead.phone,
                    countryCode: phoneMatch ? phoneMatch[1] : '+251',
                    conversation: lead.conversation,
                    status: lead.status,
                    temperature: lead.temperature
                });
                setShowForm(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('Are you sure you want to delete this lead?')) {
                    setLeads(leads.filter(lead => lead.id !== id));
                }
            };

            const handleCancel = () => {
                setShowForm(false);
                setEditingLead(null);
                setFormData({
                    name: '',
                    phone: '',
                    countryCode: '+251',
                    conversation: '',
                    status: 'New',
                    temperature: 'Warm'
                });
            };

            const filteredLeads = leads.filter(lead => {
                const matchesSearch = lead.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    lead.phone.includes(searchTerm) ||
                    lead.conversation.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesStatus = filterStatus === 'all' || lead.status === filterStatus;
                const matchesTemp = filterTemperature === 'all' || lead.temperature === filterTemperature;

                return matchesSearch && matchesStatus && matchesTemp;
            });

            const getTempColor = (temp) => {
                switch (temp) {
                    case 'Hot': return 'bg-red-100 text-red-800 border-red-300';
                    case 'Warm': return 'bg-orange-100 text-orange-800 border-orange-300';
                    case 'Cold': return 'bg-blue-100 text-blue-800 border-blue-300';
                    default: return 'bg-gray-100 text-gray-800 border-gray-300';
                }
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'New': return 'bg-purple-100 text-purple-800';
                    case 'Contacted': return 'bg-blue-100 text-blue-800';
                    case 'Follow-Up': return 'bg-yellow-100 text-yellow-800';
                    case 'Meeting Scheduled': return 'bg-green-100 text-green-800';
                    case 'Closed Won': return 'bg-green-600 text-white';
                    case 'Closed Lost': return 'bg-gray-400 text-white';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            const getTempIcon = (temp) => {
                return temp === 'Hot' ? <Flame /> : <Thermometer />;
            };

            const stats = {
                total: leads.length,
                hot: leads.filter(l => l.temperature === 'Hot').length,
                warm: leads.filter(l => l.temperature === 'Warm').length,
                cold: leads.filter(l => l.temperature === 'Cold').length,
                new: leads.filter(l => l.status === 'New').length,
                followUp: leads.filter(l => l.status === 'Follow-Up').length
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="bg-white shadow-sm border-b">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex justify-between items-center flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <div className="text-blue-600"><Phone /></div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-800">Lead Tracker CRM</h1>
                                        <p className="text-sm text-gray-500">Real-time JSON storage</p>
                                    </div>
                                </div>
                                <div className="flex gap-2 flex-wrap">
                                    <label className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition cursor-pointer">
                                        <Upload /> Import JSON
                                        <input type="file" accept=".json" onChange={importFromJSON} className="hidden" />
                                    </label>
                                    <button
                                        onClick={exportToJSON}
                                        className="bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-purple-700 transition"
                                        disabled={leads.length === 0}
                                    >
                                        <Download /> Export JSON
                                    </button>
                                    <button
                                        onClick={() => setShowForm(true)}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition"
                                    >
                                        <Plus /> Add Lead
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="bg-white border-b">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">Total Leads</p>
                                    <p className="text-2xl font-bold text-blue-600">{stats.total}</p>
                                </div>
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">üî• Hot</p>
                                    <p className="text-2xl font-bold text-red-600">{stats.hot}</p>
                                </div>
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">üå§Ô∏è Warm</p>
                                    <p className="text-2xl font-bold text-orange-600">{stats.warm}</p>
                                </div>
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">‚ùÑÔ∏è Cold</p>
                                    <p className="text-2xl font-bold text-blue-600">{stats.cold}</p>
                                </div>
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">New</p>
                                    <p className="text-2xl font-bold text-purple-600">{stats.new}</p>
                                </div>
                                <div className="bg-white rounded-lg p-3 text-center border border-gray-200">
                                    <p className="text-xs text-gray-600 mb-1">Follow-Up</p>
                                    <p className="text-2xl font-bold text-yellow-600">{stats.followUp}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        {/* Search and Filter */}
                        <div className="bg-white rounded-lg shadow-sm p-4 mb-6">
                            <div className="grid md:grid-cols-3 gap-4">
                                <div className="relative">
                                    <div className="absolute left-3 top-3 text-gray-400"><Search /></div>
                                    <input
                                        type="text"
                                        placeholder="Search..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                </div>
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="all">All Statuses</option>
                                    {statusOptions.map(s => <option key={s} value={s}>{s}</option>)}
                                </select>
                                <select
                                    value={filterTemperature}
                                    onChange={(e) => setFilterTemperature(e.target.value)}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="all">All Temperatures</option>
                                    {temperatureOptions.map(t => <option key={t} value={t}>{t}</option>)}
                                </select>
                            </div>
                        </div>

                        {/* Form Modal */}
                        {showForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                    <div className="p-6 border-b flex justify-between items-center sticky top-0 bg-white">
                                        <h3 className="text-xl font-bold">{editingLead ? 'Edit Lead' : 'Add New Lead'}</h3>
                                        <button onClick={handleCancel} className="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                                    </div>

                                    <div className="p-6 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Name *</label>
                                            <input
                                                type="text"
                                                value={formData.name}
                                                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                placeholder="John Doe"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-2">Phone Number *</label>
                                            <div className="flex gap-2">
                                                <select
                                                    value={formData.countryCode}
                                                    onChange={(e) => setFormData({ ...formData, countryCode: e.target.value })}
                                                    className="w-32 px-3 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    <option value="+251">üá™üáπ +251</option>
                                                    <option value="+1">üá∫üá∏ +1</option>
                                                    <option value="+44">üá¨üáß +44</option>
                                                    <option value="+971">üá¶üá™ +971</option>
                                                    <option value="+966">üá∏üá¶ +966</option>
                                                    <option value="+254">üá∞üá™ +254</option>
                                                </select>
                                                <input
                                                    type="tel"
                                                    value={formData.phone}
                                                    onChange={(e) => setFormData({ ...formData, phone: e.target.value.replace(/[^0-9]/g, '') })}
                                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg"
                                                    placeholder="912345678"
                                                />
                                            </div>
                                            <p className="text-xs text-gray-500 mt-1">Full: {formData.countryCode} {formData.phone}</p>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-2">Conversation Notes *</label>
                                            <textarea
                                                value={formData.conversation}
                                                onChange={(e) => setFormData({ ...formData, conversation: e.target.value })}
                                                rows="4"
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                placeholder="Details about the conversation..."
                                            />
                                        </div>

                                        <div className="grid md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Status</label>
                                                <select
                                                    value={formData.status}
                                                    onChange={(e) => setFormData({ ...formData, status: e.target.value })}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    {statusOptions.map(s => <option key={s} value={s}>{s}</option>)}
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Temperature</label>
                                                <select
                                                    value={formData.temperature}
                                                    onChange={(e) => setFormData({ ...formData, temperature: e.target.value })}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                                >
                                                    {temperatureOptions.map(t => <option key={t} value={t}>{t}</option>)}
                                                </select>
                                            </div>
                                        </div>

                                        <div className="flex gap-3 pt-4">
                                            <button
                                                onClick={handleSubmit}
                                                className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium"
                                            >
                                                {editingLead ? 'Update Lead' : 'Add Lead'}
                                            </button>
                                            <button
                                                onClick={handleCancel}
                                                className="flex-1 bg-gray-200 text-gray-800 py-3 rounded-lg hover:bg-gray-300 font-medium"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Leads List */}
                        <div className="space-y-4">
                            {filteredLeads.length === 0 ? (
                                <div className="bg-white rounded-lg shadow-sm p-12 text-center">
                                    <div className="text-gray-300 mb-4 flex justify-center"><Phone /></div>
                                    <h3 className="text-xl font-semibold text-gray-600 mb-2">No leads found</h3>
                                    <p className="text-gray-500 mb-6">Start by adding your first lead or import from JSON</p>
                                    <button
                                        onClick={() => setShowForm(true)}
                                        className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 inline-flex items-center gap-2"
                                    >
                                        <Plus /> Add Your First Lead
                                    </button>
                                </div>
                            ) : (
                                filteredLeads.map(lead => (
                                    <div key={lead.id} className="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-3 mb-2">
                                                    <h3 className="text-xl font-semibold text-gray-800">{lead.name}</h3>
                                                    <div className={`flex items-center gap-1 px-3 py-1 rounded-full border-2 ${getTempColor(lead.temperature)}`}>
                                                        {getTempIcon(lead.temperature)}
                                                        <span className="text-sm font-medium">{lead.temperature}</span>
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2 text-gray-600 mb-3">
                                                    <div style={{ width: '16px', height: '16px' }}><Phone /></div>
                                                    <a href={`tel:${lead.phone}`} className="hover:text-blue-600">{lead.phone}</a>
                                                </div>
                                                <span className={`inline-block px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(lead.status)}`}>
                                                    {lead.status}
                                                </span>
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => handleEdit(lead)}
                                                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition"
                                                >
                                                    <Edit2 />
                                                </button>
                                                <button
                                                    onClick={() => handleDelete(lead.id)}
                                                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition"
                                                >
                                                    <Trash2 />
                                                </button>
                                            </div>
                                        </div>

                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <p className="text-sm font-medium text-gray-600 mb-2">Conversation Notes:</p>
                                            <p className="text-gray-700 whitespace-pre-wrap">{lead.conversation}</p>
                                        </div>

                                        <div className="mt-3 flex justify-between text-xs text-gray-500">
                                            <span>Created: {new Date(lead.createdAt).toLocaleString()}</span>
                                            <span>Updated: {new Date(lead.updatedAt).toLocaleString()}</span>
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<LeadTrackerApp />);
    </script>
</body>
</html>
